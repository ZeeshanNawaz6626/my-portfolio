(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,184762,e=>{"use strict";var a=e.i(889203),t=e.i(647163);function s({className:e,...s}){return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,t.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...s})}e.s(["Textarea",()=>s])},560806,e=>{"use strict";let a=(0,e.i(477423).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>a],560806)},875158,e=>{"use strict";let a=(0,e.i(477423).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>a],875158)},623503,e=>{"use strict";let a=(0,e.i(477423).default)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);e.s(["MessageSquare",()=>a],623503)},513871,e=>{"use strict";let a=(0,e.i(477423).default)("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);e.s(["Edit3",()=>a],513871)},436827,e=>{"use strict";let a=(0,e.i(477423).default)("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]);e.s(["Reply",()=>a],436827)},463508,e=>{"use strict";var a=e.i(889203),t=e.i(542672),s=e.i(166075),l=e.i(167881),r=e.i(184762),i=e.i(63270),n=e.i(269035),d=e.i(994179),c=e.i(671428),m=e.i(995403),o=e.i(623503),x=e.i(436827),h=e.i(513871),u=e.i(560806),p=e.i(875158),g=e.i(117769);function j({postSlug:e}){let{user:j,isAuthenticated:f,isLoading:v}=(0,s.useAuth)(),[b,N]=(0,t.useState)(!0),[y]=(0,t.useState)(1),[k]=(0,t.useState)(50),[w,S]=(0,t.useState)([]),[C,A]=(0,t.useState)([]),[E,I]=(0,t.useState)(""),[T,M]=(0,t.useState)(null),[B,z]=(0,t.useState)(null),[D,R]=(0,t.useState)(""),F=async()=>{N(!0);try{let a=await fetch(`/api/comments/${e}?page=${y}&pageSize=${k}`),t=await a.json();t.ok&&(S(t.comments||[]),A(t.myPending||[]))}catch{}finally{N(!1)}};(0,t.useEffect)(()=>{F()},[e,y]);let P=(0,t.useMemo)(()=>{var e;let a,t,s;return e=[...w,...C],a=new Map,t=[],e.forEach(e=>a.set(e.commentId,{...e})),e.forEach(e=>{if(e.parentId&&a.has(e.parentId)){let t=a.get(e.parentId);t.children=t.children||[],t.children.push(a.get(e.commentId))}else t.push(a.get(e.commentId))}),(s=e=>{e.sort((e,a)=>new Date(e.createdAt).getTime()-new Date(a.createdAt).getTime()),e.forEach(e=>e.children&&s(e.children))})(t),t},[w,C]),U=(0,t.useMemo)(()=>w.length,[w]),O=async()=>{if(E.trim())try{let a=await fetch(`/api/comments/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:E,parentId:T})}),t=await a.json();if(!a.ok)throw Error(t.error||"Failed to post");m.toast.success("Comment submitted and awaiting approval"),I(""),M(null),F()}catch(a){let e=a instanceof Error?a.message:"Failed to submit comment";m.toast.error(e)}},$=async e=>{if(confirm("Delete this comment?"))try{let a=await fetch(`/api/comment/${e}`,{method:"DELETE"}),t=await a.json();if(!a.ok)throw Error(t.error||"Delete failed");m.toast.success("Comment deleted"),F()}catch(a){let e=a instanceof Error?a.message:"Failed to delete";m.toast.error(e)}},H=async()=>{if(B)try{let e=await fetch(`/api/comment/${B}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:D})}),a=await e.json();if(!e.ok)throw Error(a.error||"Update failed");m.toast.success("Updated. Awaiting approval"),z(null),R(""),F()}catch(a){let e=a instanceof Error?a.message:"Failed to update";m.toast.error(e)}},L=({c:e,depth:t=0})=>{let s=j?.id,n=s&&e.userId===s,c="pending"===e.status;return(0,a.jsxs)("div",{className:"mt-4",style:{marginLeft:16*t},children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(i.Avatar,{className:"h-8 w-8",children:[(0,a.jsx)(i.AvatarImage,{src:e.authorAvatar}),(0,a.jsx)(i.AvatarFallback,{children:(e.authorName||"?").slice(0,2).toUpperCase()})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:e.authorName||"User"}),e.isAdminReply&&(0,a.jsx)(d.Badge,{variant:"secondary",className:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300",children:"Admin"}),n&&c&&(0,a.jsx)(d.Badge,{variant:"secondary",className:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300",children:"awaiting approval"}),(0,a.jsxs)("span",{className:"ml-auto flex items-center gap-1 text-sm text-slate-500",children:[(0,a.jsx)(g.Clock,{className:"h-4 w-4"})," ",new Date(e.createdAt).toLocaleString()]})]}),B===e.commentId?(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)(r.Textarea,{value:D,onChange:e=>R(e.target.value),rows:3}),(0,a.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,a.jsx)(l.Button,{size:"sm",onClick:H,children:"Save"}),(0,a.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>z(null),children:"Cancel"})]})]}):(0,a.jsx)("p",{className:"mt-1 text-sm text-slate-700 dark:text-slate-300",dangerouslySetInnerHTML:{__html:e.content}}),(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-1 text-xs text-slate-500",children:[(0,a.jsxs)(l.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>M(e.commentId),"aria-label":"Reply to comment",children:[(0,a.jsx)(x.Reply,{className:"mr-1 h-3.5 w-3.5"})," Reply"]}),n&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>{z(e.commentId),R(e.content)},"aria-label":"Edit comment",children:[(0,a.jsx)(h.Edit3,{className:"mr-1 h-3.5 w-3.5"})," Edit"]}),(0,a.jsxs)(l.Button,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs text-red-600 hover:text-red-700",onClick:()=>$(e.commentId),"aria-label":"Delete comment",children:[(0,a.jsx)(u.Trash2,{className:"mr-1 h-3.5 w-3.5"})," Delete"]})]})]})]})]}),e.children?.map(e=>(0,a.jsx)(L,{c:e,depth:(t||0)+1},e.commentId))]})};return(0,a.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-6 dark:border-slate-800 dark:bg-slate-900",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-blue-50 dark:bg-blue-950/30",children:(0,a.jsx)(o.MessageSquare,{className:"h-4 w-4 text-blue-600"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Comments"}),(0,a.jsx)(d.Badge,{variant:"secondary",className:"ml-2 bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300",children:U})]}),!v&&f&&(0,a.jsxs)("div",{className:"mb-6",children:[T&&(0,a.jsxs)("div",{className:"mb-2 inline-flex items-center gap-2 rounded-md border border-blue-200 bg-blue-50 px-2 py-1 text-xs text-blue-700 dark:border-blue-900/40 dark:bg-blue-950/30 dark:text-blue-300",children:["Replying to ",(0,a.jsx)("code",{className:"rounded bg-white px-1 dark:bg-slate-800",children:T}),(0,a.jsx)("button",{className:"underline",onClick:()=>M(null),children:"cancel"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(i.Avatar,{className:"h-8 w-8",children:[(0,a.jsx)(i.AvatarImage,{src:j?.picture}),(0,a.jsx)(i.AvatarFallback,{children:(j?.given_name||j?.email||"?").slice(0,2).toUpperCase()})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(r.Textarea,{placeholder:"Write a comment...",value:E,onChange:e=>I(e.target.value),rows:4}),(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-xs text-slate-500",children:"Be kind. No spam. Offensive comments will be removed and may result in a permanent ban."}),(0,a.jsxs)(l.Button,{variant:"blue",onClick:O,disabled:!E.trim(),className:"gap-2",children:[(0,a.jsx)(p.Send,{className:"h-4 w-4"})," Post"]})]})]})]})]}),!v&&!f&&(0,a.jsx)("div",{className:"mb-6 text-sm text-slate-600 dark:text-slate-400",children:"Please log in to post a comment."}),(0,a.jsx)(n.Separator,{className:"my-4"}),b?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(c.Skeleton,{className:"h-8 w-8 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(c.Skeleton,{className:"h-16 w-full"}),(0,a.jsx)("div",{className:"mt-2 flex justify-end",children:(0,a.jsx)(c.Skeleton,{className:"h-9 w-24"})})]})]}),Array.from({length:3}).map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(c.Skeleton,{className:"h-8 w-8 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(c.Skeleton,{className:"h-4 w-48"}),(0,a.jsx)(c.Skeleton,{className:"mt-2 h-12 w-full"})]})]},t))]}):0===P.length?(0,a.jsx)("div",{className:"text-sm text-slate-500",children:"No comments yet."}):(0,a.jsx)("div",{children:P.map(e=>(0,a.jsx)(L,{c:e},e.commentId))})]})}e.s(["default",()=>j])},756778,e=>{e.n(e.i(463508))}]);